services:
    PiwikBundle\Service\NewTracker:
        arguments:
            - '@PiwikBundle\Api\PhpClient'
            - '@PiwikBundle\Api\JsClient'
            - '%piwik_enable_js_tracker%'
            - '@LegacyBundle\Service\Exchanger'
            - '@SubscriptionBundle\Service\SubscriptionPackProvider'
            - '@session'
            - '%campaign_session_name%'
            - '@App\Domain\Repository\CampaignRepository'
            - '@SubscriptionBundle\Repository\Game\SubscribedGameRepository'
            - '@LegacyBundle\Service\SubscriptionConstraintsByCarrier'
            - '@device_detection.service.device'

    PiwikBundle\Twig\PiwikExtension:
        arguments: ['@PiwikBundle\Api\JsClient', '%piwik_enable_js_tracker%']
        tags:
            - { name: twig.extension }
            
    PiwikBundle\Api\ClientAbstract:
        abstract: true
        arguments: ['%piwik_id_site%', '%piwik_host%', '%piwik_https%', '%piwik_token_auth%']
        calls:
            - [setRabbitMQService, ['@enqueue.client.producer']]

    PiwikBundle\Api\PhpClient:
        arguments: ['%piwik_id_site%', '%piwik_host%', '%piwik_https%', '%piwik_token_auth%', '@logger']
        calls:
            - [setRabbitMQService, ['@enqueue.client.producer']]

    PiwikBundle\Api\JsClient:
        parent: PiwikBundle\Api\ClientAbstract
        calls:
            - ['setEnableLinkTracking', ['%piwik_enable_link_tracking%']]

    RabbitMqBundle\Service\SendToAMQP\SendToDirectExchange:
        arguments: ['@wl_rabbit_mq.connection']

    PiwikBundle\Service\PiwikDataSender:
        arguments: ['@PiwikBundle\Api\PhpClient']

    PiwikBundle\Enqueue\PiwikEventsConsumer:
        arguments: ['@PiwikBundle\Service\PiwikDataSender', '@enqueue.client.producer', '@enqueue.transport.rabbitmq_amqp.context']
        tags:
          - { name: enqueue.client.processor }