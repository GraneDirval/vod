{% extends '@App/base.html.twig' %}

{% import "@App/Common/Blocks/header.html.twig" as  header %}
{% import '@App/Components/Buttons/button.html.twig' as button %}
{% import '@App/Components/Buttons/small_button.html.twig' as button_small %}

{% block header_content %}
    {{ header.render(game.title) }}
{% endblock header_content %}

{% block body %}
    <div class="d-flex align-self-start justify-content-center flex-wrap flex-column w-100 my-2">
        <img class="img-fluid" src="{{ game.iconPath }}" alt="{{ game.title }}"/>

        <div class="d-flex justify-content-center my-4-5 w-100 x-game-element" data-uuid="{{ game.uuid }}">
            {{ button.render('Download', 'game-download-button x-game-download-button') }}
        </div>

        <div class="game-screenshots w-100">
            {% for gameScreenshot in images %}
                <img src="{{ gameScreenshot.iconPath }}" alt="Screenshot">
            {% endfor %}
        </div>

        <div class="d-flex m-2">
            {{ game.description|raw }}
        </div>

        <div class="d-flex justify-content-center my-4-5 x-game-element" data-uuid="{{ game.uuid }}">
            {{ button.render('Download', 'game-download-button x-game-download-button') }}
        </div>

        <div class="d-flex align-items-center justify-content-between separator-title my-4">
            <span class=" before"></span>
            <span class="title">Other games</span>
            <span class=" after"></span>
        </div>
        <div class="game-similars w-100">
            {% for similarGame in similarGames %}
                <div class="d-flex flex-column  x-game-element game-wrapper" data-uuid="{{similarGame.uuid}}">
                    <div class="game">
                        <div class="game-image-block">
                            <a class="" href="{{ path('game_content',{'gameUuid': similarGame.uuid}) }}">
                                <img class="img-fluid" src="{{ similarGame.iconPath }}" alt="{{ similarGame.uuid }}"/>
                            </a>
                        </div>
                        <div class="game-info-block">
                            <div class="game-title-block">
                                {{ similarGame.title }}
                            </div>
                            <div class="game-download-button-block">
                                {% if hasActiveSubscription() %}
                                    {{ button_small.render('Download', 'game-download-button x-game-download-button') }}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock body %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.min.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick-theme.min.css"/>
    <link rel="stylesheet" type="text/css" href="{{ asset('css/games.css') }}"/>
{% endblock stylesheets %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            $('.game-screenshots').slick({
                variableWidth: true,
            });
            $('.game-similars').slick({
                variableWidth: true,
            });

            $(document).on('click', '.x-game-download-button', function () {
                var button = $(this);
                var parent = button.parents('.x-game-element');
                var uuid   = parent.attr('data-uuid');
                var link   = "{{ path('download_game') }}" + '?id=' + uuid;

                $.ajax({
                    url       : link,
                    method    : 'GET',
                    beforeSend: function () {
                        button.attr('disabled', 1)
                    },
                    complete  : function () {
                        button.attr('disabled', null)
                    },
                    success   : function (data) {
                        if (data.url) {
                            window.location = data.url;
                        }else{
                            alert('Internal error. Please try again later')
                        }
                    }
                })
            });
        });
    </script>
{% endblock  javascripts %}