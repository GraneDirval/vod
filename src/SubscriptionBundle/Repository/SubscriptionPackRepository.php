<?php

namespace SubscriptionBundle\Repository;

use Doctrine\ORM\AbstractQuery;
use Doctrine\ORM\EntityRepository;
use SubscriptionBundle\Entity\SubscriptionPack;

/**
 * SubscriptionPackRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class SubscriptionPackRepository extends EntityRepository
{

    /**
     * @param SubscriptionPack $subscriptionPack
     *
     * @return array
     */
    public function getActiveSubscriptionPacksByCarrierId(SubscriptionPack $subscriptionPack)
    {
        $qb = $this->createQueryBuilder('sp');

        $query = $qb
            ->where('sp.status = :status ')
            ->andWhere('sp.billingCarrierId = :billingCarrierId')
            ->andWhere('sp.uuid != :uuid')
            ->setParameters([
                'status' => SubscriptionPack::ACTIVE_SUBSCRIPTION_PACK,
                'billingCarrierId' => $subscriptionPack->getCarrier()->getBillingCarrierId(),
                'uuid' => $subscriptionPack->getUuid()
            ])
            ->getQuery();

        return $query->getResult();
    }
}
