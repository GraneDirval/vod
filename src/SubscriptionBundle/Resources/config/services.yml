services:
    subscription.http.client:
        class: "%guzzle.client.class%"
        tags:
            - { name: guzzle.client }

    SubscriptionBundle\Service\SubscriptionTextService:
        arguments:
            - '@App\Domain\Repository\TranslationRepository'
            - '@SubscriptionBundle\Service\SubscriptionText\SubscriptionTextProvider'

    SubscriptionBundle\Service\SubscriptionText\SubscriptionTextProvider:
        arguments:
            - '@App\Domain\Repository\LanguageRepository'
            - '@SubscriptionBundle\Service\SubscriptionText\QueryManager'

    SubscriptionBundle\Service\SubscriptionText\QueryManager:
        arguments: ['@SubscriptionBundle\Service\SubscriptionText\DeclensionHelper']

    SubscriptionBundle\Service\SubscriptionText\DeclensionHelper: ~

    #SubscriptionBundle\Service\UserExtractor:
    #    class: SubscriptionBundle\Service\UserProvider
    #    arguments:
    #        - "@session"
    #        - "@identification.service"
    #        - "@user_bundle.users_service"
    #        - "@router"
    #        - "%token_session_name%"
    #        - '@monolog.logger.subscription_log'


    #subscription.monolog.db_handler:
    #        class: SubscriptionBundle\Service\Logs\MonologDBHandler
    #        arguments: ['@doctrine.orm.entity_manager']

    #subscription.monolog.processor.request:
    #        class: SubscriptionBundle\Service\Logs\RequestProcessor
    #        arguments: ['@request_stack', '@service_container']
    #        tags:
    #            - { name: monolog.processor, method: processRecord, handler: db }

    SubscriptionBundle\Service\SubscriptionPackProvider:
        arguments: ['@SubscriptionBundle\Repository\SubscriptionPackRepository']

    SubscriptionBundle\Service\EntitySaveHelper:
        arguments: ['@doctrine.orm.entity_manager', '@logger']

    SubscriptionBundle\Service\SubscriptionExtractor:
        arguments: ['@SubscriptionBundle\Repository\SubscriptionRepository', '@IdentificationBundle\Repository\UserRepository']

    SubscriptionBundle\Service\CampaignExtractor:
        arguments:
            - '@App\Domain\Repository\CampaignRepository'

    SubscriptionBundle\Service\SubscriptionCreator:
        arguments: ['@SubscriptionBundle\Service\EntitySaveHelper']

    SubscriptionBundle\Service\RenewDateCalculator: ~

    SubscriptionBundle\Service\CreditsCalculator:
        arguments: ['@SubscriptionBundle\Service\RenewDateCalculator']

    SubscriptionBundle\Service\Action\Common\FakeResponseProvider:
        arguments:
          ['@logger', '@event_dispatcher']

    SubscriptionBundle\Service\Action\Common\RequestParametersProvider:
        arguments: ['@request_stack', '@event_dispatcher', '@router', '@session']

    SubscriptionBundle\Service\Action\Common\PromotionalResponseChecker: ~

    SubscriptionBundle\Service\Action\Common\CommonSubscriptionUpdater:
        arguments: ['@event_dispatcher']

    SubscriptionBundle\Service\UserExtractor:
        arguments: ['@router.default', '@logger', '@IdentificationBundle\Repository\UserRepository']

    SubscriptionBundle\Service\RefundService:
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@SubscriptionBundle\BillingFramework\Process\API\Client'
            - '@SubscriptionBundle\Service\ReportingToolService'

    SubscriptionBundle\Service\ReportingToolService:
        arguments:
            - '%reporting_stats_api_host%'

    SubscriptionBundle\Service\Blacklist\BlacklistSaver:
        arguments:
            - '@IdentificationBundle\Repository\UserRepository'
            - '@doctrine.orm.entity_manager'
            - '@SubscriptionBundle\Repository\SubscriptionRepository'
            - '@SubscriptionBundle\Service\Action\Unsubscribe\Handler\UnsubscriptionHandlerProvider'
            - '@SubscriptionBundle\Service\Action\Unsubscribe\Unsubscriber'
            -
    SubscriptionBundle\Service\Blacklist\BlacklistChecker:
        arguments:
            - '@IdentificationBundle\Repository\UserRepository'
            - '@SubscriptionBundle\Repository\BlackListRepository'
            - '@logger'

    SubscriptionBundle\Service\Blacklist\BlacklistAttemptRegistrator:
        arguments:
            - '@IdentificationBundle\Repository\CarrierRepositoryInterface'
            - '@app.cache.default.subscription'
            - '@SubscriptionBundle\Service\Blacklist\BlacklistSaver'
            - '@IdentificationBundle\Identification\Service\IdentificationDataStorage'
            - '@IdentificationBundle\Repository\UserRepository'
            - '@logger'

    SubscriptionBundle\Service\Notification\Email\CAPNotificationSender:
        arguments:
            - '@ExtrasBundle\Email\EmailSender'
            - '%cap_notification_mail_to%'
            - '%cap_notification_mail_from%'


    SubscriptionBundle\Service\SubscriptionSerializer: ~

    SubscriptionBundle\Service\SubscribeUrlResolver:
        arguments:
            - '@router'
            - '@SubscriptionBundle\Service\Action\Subscribe\Handler\SubscriptionHandlerProvider'

    SubscriptionBundle\Service\ZeroCreditSubscriptionChecking:
        arguments:
            - '@SubscriptionBundle\Service\CampaignExtractor'

    SubscriptionBundle\Service\LPDataExtractor:
        arguments:
            - '@IdentificationBundle\Repository\CarrierRepositoryInterface'
            - '@App\Domain\Repository\CountryRepository'


parameters:
    subscription.subscription.class: SubscriptionBundle\Entity\SubscriptionPack
    guzzle.client.class: GuzzleHttp\Client

