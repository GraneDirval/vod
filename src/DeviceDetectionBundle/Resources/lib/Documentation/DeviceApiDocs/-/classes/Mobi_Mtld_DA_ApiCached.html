<!DOCTYPE html>
<!--

This documentation was created by Artaengine doxer PHP source documenter.
http://artaengine.com

 -->
<html>
  <head>
    <title>Mobi_Mtld_DA_ApiCached documentation</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="description"  content="Generated by Artaengine DocBlocks"/>
    <link rel="shortcut icon" type="image/x-icon" href="resources/images/fav.png"/>
    <link rel="stylesheet" type="text/css" href="../../resources/css/style.css"/>
    <script src="../../resources/js/jquery.js" type="text/javascript"></script>
    <script type="text/javascript">
    //<![CDATA[
        $(document).ready(function () {
            $.expr[":"].contains = $.expr.createPseudo(function (arg) {
                    return function (elem) {
                    return $(elem).text().toUpperCase().indexOf(arg.toUpperCase()) >= 0;
                };
            });

            $('#search-input').keyup(function (e) {
                var text = $(this).val();
                $('#class-index li.item').hide();
                $("#class-index li.item a:contains('"+text+"')").parent().show();

                $('#consts h3').parent().hide();
                $("#consts h3:contains('"+text+"')").parent().show();

                $('#properties h3').parent().hide();
                $("#properties h3:contains('"+text+"')").parent().show();
                $('#static-properties h3').parent().hide();
                $("#static-properties h3:contains('"+text+"')").parent().show();

                $('#methods h3').parent().hide();
                $("#methods h3:contains('"+text+"')").parent().show();
                $('#static-methods h3').parent().hide();
                $("#static-methods h3:contains('"+text+"')").parent().show();
            });

            $('h2').click(function (e) {
                var id = $(this).attr('id');
                $('#'+id.substring(0, id.length - 6)).toggle('fast');
            });
        });
    //]]>
    </script>
  </head>
  <body>

    <!-- index of class members -->
    <ul id="class-index">
  <li id="search-input-container"><input id="search-input" type="text" placeholder="Search..."/></li>
  <li id="go-back"><a href="../../index.html">DEPRECATED Mobi_Mtld_DA</a></li>
  <ul>
  <li id="index-methods"><a href="#methods">Methods</a></li>
  <li class="item"><a href="#method-__construct">__construct</a></li>
<li class="item"><a href="#method-clearTreeOptimizerCache">clearTreeOptimizerCache</a></li>
<li class="item"><a href="#method-getProperties">getProperties</a></li>
<li class="item"><a href="#method-getProperty">getProperty</a></li>
<li class="item"><a href="#method-populateTreeOptimizerCache">populateTreeOptimizerCache</a></li>
<li class="item"><a href="#method-setUseSysTempDir">setUseSysTempDir</a></li>

</ul>

</ul>


    <div id="goto-top"><a href="#">TOP</a></div>

    <div id="doc">
      <h1>Mobi_Mtld_DA_ApiCached</h1>

      <div id="class-specs">
        <div id="class-comment">This class significantly improves core DA PHP Api performance
when used on a standard website with a single detection per request.

Current optimizations consists of two main parts:

1) tree optimizer - speeds up loading the json file<br/>
2) cache provider - caches the results

<b>Typical usage:</b>

<pre>
 $ua = $_SERVER['HTTP_USER_AGENT'];

 $da_cache_provider = new Mobi_Mtld_DA_CacheProvider_FileCacheProvider();
 $da_api_cached = new Mobi_Mtld_DA_ApiCached("json/sample.json",
												$da_cache_provider);

 $properties = $da_api_cached->getProperties($ua);
 </pre>

Client side properties

Client side properties can be collected and merged into the results by
using the DeviceAtlas Javascript detection file. The results from the client
side are sent to the server inside a cookie. The contents of this cookie can
be passed to the DeviceAtlas getProperty and getProperties methods. The
client side properties over-ride any data file properties and also serve as
an input into additional logic to determine other properties such as the
iPhone models that are otherwise not detectable. The following code shows
how this can be done:

<pre>
 $ua = $_SERVER['HTTP_USER_AGENT'];

 // Get the cookie containing the client side properties
 $cookie_contents = null;
 if (isset($_COOKIE['DAPROPS'])){
   $cookie_contents = $_COOKIE['DAPROPS'];
 }

 $da_cache_provider = new Mobi_Mtld_DA_CacheProvider_FileCacheProvider();
 $da_api_cached = new Mobi_Mtld_DA_ApiCached("json/sample.json",
												$da_cache_provider);

 $properties = $da_api_cached->getProperties($ua, $cookie_contents);
 </pre>

<b>Note:</b>

It is not recommended to use ApiCached extension for batch processing
(i.e. multiple User-Agent detections during a single request). In these
situations use standard API interface.

See Api.php for more information</div>
        <div id="class-info">
          <dl><dt class="file">Source</dt>
<dd class="file">ApiCached.php</dd>
<dt class="dependencies">Depends on</dt>
<dd class="dependencies">Mobi_Mtld_DA_CacheProvider_CacheProviderInterface<br/><a href="../../Mobi_Mtld_DA_Device/classes/Mobi_Mtld_DA_Device_Config.html">Mobi_Mtld_DA_Device_Config</a><br/><a href="../../Mobi_Mtld_DA_Device/classes/Mobi_Mtld_DA_Device_DeviceApi.html">Mobi_Mtld_DA_Device_DeviceApi</a><br/><a href="../../Mobi_Mtld_DA_Exception/classes/Mobi_Mtld_DA_Exception_InvalidPropertyException.html">Mobi_Mtld_DA_Exception_InvalidPropertyException</a><br/><a href="../../Mobi_Mtld_DA_Device/classes/Mobi_Mtld_DA_Device_TreeOptimized.html">Mobi_Mtld_DA_Device_TreeOptimized</a></dd>
</dl>
        </div>
        <div id="class-atts"><dl class="class-atts"><dt class="author">Author</dt>
<dd class="author">Afilias Technologies Ltd</dd>
<dt class="deprecated">Deprecated</dt>
<dd class="deprecated">This API is deprecated, it is highly recommended to use the new <a href="../../Mobi_Mtld_DA_Device/classes/Mobi_Mtld_DA_Device_DeviceApi.html">DeviceApi</a> instead.</dd>
<dt class="copyright">Copyright</dt>
<dd class="copyright">Copyright (c) 2008-2015 by Afilias Technologies Limited (dotMobi). All rights reserved.</dd>
</dl>
</div>
      </div>

      

      

      

      

      <h2 id="methods-title">Methods</h2>
<div id="methods"><div class="method public  odd first" id="method-__construct">
  <h3>__construct</h3>
  <div class="method-specs">

    <div><pre class="method-def expanded"><span class="return-type">Mobi_Mtld_DA_ApiCached</span> $obj = new Mobi_Mtld_DA_ApiCached(
    <span class="param-type">string</span> <span class="param-name">$pathToJson</span>,
    <span class="param-type">Mobi_Mtld_DA_CacheProvider_CacheProviderInterface</span> <span class="param-name">$cacheProvider</span>,
    <span class="param-type">boolean</span> <span class="param-name">$useTreeOptimizer</span>,
    <span class="param-type">string</span> <span class="param-name">$treeOptimizerCacheDir</span>,
    <span class="param-type">boolean</span> <span class="param-name">$includeChangeableUserAgentProperties</span>
)</pre></div>

    <p class="method-comment">Creates new instance of Mobi_Mtld_DA_ApiCached object</p>

    
    <h4>Arguments</h4>
<div class="method-args">
  <ul class="items-container">
<div class="argument">
  <dl>
    <dt>
      $pathToJson
      <span>(string)</span>
    </dt>
    <dd>
       The location of the file to read in.
    </dd>
  </dl>
</div>
<div class="argument">
  <dl>
    <dt>
      $cacheProvider
      <span>(<a href="../../Mobi_Mtld_DA_CacheProvider/interfaces/Mobi_Mtld_DA_CacheProvider_CacheProviderInterface.html">Mobi_Mtld_DA_CacheProvider_CacheProviderInterface</a>)</span>
    </dt>
    <dd>
      
    </dd>
  </dl>
</div>
<div class="argument">
  <dl>
    <dt>
      $useTreeOptimizer
      <span>(boolean)</span>
    </dt>
    <dd>
      
    </dd>
  </dl>
</div>
<div class="argument">
  <dl>
    <dt>
      $treeOptimizerCacheDir
      <span>(string)</span>
    </dt>
    <dd>
       Cache directory for the tree optimizer; uses sys_get_temp_dir() by default
    </dd>
  </dl>
</div>
<div class="argument">
  <dl>
    <dt>
      $includeChangeableUserAgentProperties
      <span>(boolean)</span>
    </dt>
    <dd>
       Also detect changeable user-agent properties
    </dd>
  </dl>
</div>

</ul>

</div>


    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class="">void</dt>
<dd class=""></dd>
</dl>

</div>


    

  </div>
</div>
<div class="method public  even" id="method-clearTreeOptimizerCache">
  <h3>clearTreeOptimizerCache</h3>
  <div class="method-specs">

    <div><pre class="method-def compact"><span class="return-type">void </span>$obj->clearTreeOptimizerCache()</pre></div>

    <p class="method-comment">Deletes all TreeOptimizer cache files</p>

    
    
    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class="">void</dt>
<dd class=""></dd>
</dl>

</div>


    

  </div>
</div>
<div class="method public  odd" id="method-getProperties">
  <h3>getProperties</h3>
  <div class="method-specs">

    <div><pre class="method-def compact"><span class="return-type">array </span>$obj->getProperties(<span class="param-type">string</span> <span class="param-name">$userAgent</span>, <span class="param-type">string | null</span> <span class="param-name">$cookie</span>)</pre></div>

    <p class="method-comment">Returns an array of known properties (as strings) for the user agent</p>

    
    <h4>Arguments</h4>
<div class="method-args">
  <ul class="items-container">
<div class="argument">
  <dl>
    <dt>
      $userAgent
      <span>(string)</span>
    </dt>
    <dd>
       String from the device's User-Agent header
    </dd>
  </dl>
</div>
<div class="argument">
  <dl>
    <dt>
      $cookie
      <span>(string | null)</span>
    </dt>
    <dd>
       The contents of the cookie containing the client side properties
    </dd>
  </dl>
</div>

</ul>

</div>


    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class="">array</dt>
<dd class=""> properties Property name => Property value</dd>
</dl>

</div>


    <h4>Throws</h4>
<div class="method-throws">
  <ul class="items-container">
<li><a href="../../Mobi_Mtld_DA_Exception/classes/Mobi_Mtld_DA_Exception_JsonException.html">Mobi_Mtld_DA_Exception_JsonException</a></li>

</ul>

</div>



  </div>
</div>
<div class="method public  even" id="method-getProperty">
  <h3>getProperty</h3>
  <div class="method-specs">

    <div><pre class="method-def compact"><span class="return-type">string </span>$obj->getProperty(<span class="param-type">string</span> <span class="param-name">$userAgent</span>, <span class="param-type">string</span> <span class="param-name">$property</span>, <span class="param-type">string | null</span> <span class="param-name">$cookie</span>)</pre></div>

    <p class="method-comment">Returns a value for the named property for this user agent</p>

    
    <h4>Arguments</h4>
<div class="method-args">
  <ul class="items-container">
<div class="argument">
  <dl>
    <dt>
      $userAgent
      <span>(string)</span>
    </dt>
    <dd>
       String from the device's User-Agent header
    </dd>
  </dl>
</div>
<div class="argument">
  <dl>
    <dt>
      $property
      <span>(string)</span>
    </dt>
    <dd>
       The name of the property to return
    </dd>
  </dl>
</div>
<div class="argument">
  <dl>
    <dt>
      $cookie
      <span>(string | null)</span>
    </dt>
    <dd>
       The contents of the cookie containing the client side properties
    </dd>
  </dl>
</div>

</ul>

</div>


    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class="">string</dt>
<dd class=""> property</dd>
</dl>

</div>


    <h4>Throws</h4>
<div class="method-throws">
  <ul class="items-container">
<li><a href="../../Mobi_Mtld_DA_Exception/classes/Mobi_Mtld_DA_Exception_UnknownPropertyException.html">Mobi_Mtld_DA_Exception_UnknownPropertyException</a></li>
<li><a href="../../Mobi_Mtld_DA_Exception/classes/Mobi_Mtld_DA_Exception_InvalidPropertyException.html">Mobi_Mtld_DA_Exception_InvalidPropertyException</a></li>
<li><a href="../../Mobi_Mtld_DA_Exception/classes/Mobi_Mtld_DA_Exception_JsonException.html">Mobi_Mtld_DA_Exception_JsonException</a></li>

</ul>

</div>



  </div>
</div>
<div class="method public  odd" id="method-populateTreeOptimizerCache">
  <h3>populateTreeOptimizerCache</h3>
  <div class="method-specs">

    <div><pre class="method-def compact"><span class="return-type">void </span>$obj->populateTreeOptimizerCache()</pre></div>

    <p class="method-comment">Automatically populate full TreeOptimizer cache</p>

    
    
    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class="">void</dt>
<dd class=""></dd>
</dl>

</div>


    

  </div>
</div>
<div class="method public  even last" id="method-setUseSysTempDir">
  <h3>setUseSysTempDir</h3>
  <div class="method-specs">

    <div><pre class="method-def compact"><span class="return-type">void </span>$obj->setUseSysTempDir(<span class="param-type">boolean</span> <span class="param-name">$useSysTempDir</span>)</pre></div>

    <p class="method-comment">DEPRECATED, not functional</p>

    
    <h4>Arguments</h4>
<div class="method-args">
  <ul class="items-container">
<div class="argument">
  <dl>
    <dt>
      $useSysTempDir
      <span>(boolean)</span>
    </dt>
    <dd>
      
    </dd>
  </dl>
</div>

</ul>

</div>


    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class="">void</dt>
<dd class=""></dd>
</dl>

</div>


    

  </div>
</div>
</div>


    </div>
  </body>
</html>
