<!DOCTYPE html>
<!--

This documentation was created by Artaengine doxer PHP source documenter.
http://artaengine.com

 -->
<html>
  <head>
    <title>Mobi_Mtld_DA_Carrier_CarrierApi documentation</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="description"  content="Generated by Artaengine DocBlocks"/>
    <link rel="shortcut icon" type="image/x-icon" href="resources/images/fav.png"/>
    <link rel="stylesheet" type="text/css" href="../../resources/css/style.css"/>
    <script src="../../resources/js/jquery.js" type="text/javascript"></script>
    <script type="text/javascript">
    //<![CDATA[
        $(document).ready(function () {
            $.expr[":"].contains = $.expr.createPseudo(function (arg) {
                    return function (elem) {
                    return $(elem).text().toUpperCase().indexOf(arg.toUpperCase()) >= 0;
                };
            });

            $('#search-input').keyup(function (e) {
                var text = $(this).val();
                $('#class-index li.item').hide();
                $("#class-index li.item a:contains('"+text+"')").parent().show();

                $('#consts h3').parent().hide();
                $("#consts h3:contains('"+text+"')").parent().show();

                $('#properties h3').parent().hide();
                $("#properties h3:contains('"+text+"')").parent().show();
                $('#static-properties h3').parent().hide();
                $("#static-properties h3:contains('"+text+"')").parent().show();

                $('#methods h3').parent().hide();
                $("#methods h3:contains('"+text+"')").parent().show();
                $('#static-methods h3').parent().hide();
                $("#static-methods h3:contains('"+text+"')").parent().show();
            });

            $('h2').click(function (e) {
                var id = $(this).attr('id');
                $('#'+id.substring(0, id.length - 6)).toggle('fast');
            });
        });
    //]]>
    </script>
  </head>
  <body>

    <!-- index of class members -->
    <ul id="class-index">
  <li id="search-input-container"><input id="search-input" type="text" placeholder="Search..."/></li>
  <li id="go-back"><a href="../../index.html">Mobi_Mtld_DA_Carrier</a></li>
  <ul>
  <li id="index-consts"><a href="#consts">Consts</a></li>
  <li class="item"><a href="#const-MIN_PHP_VERSION">MIN_PHP_VERSION</a></li>
<li class="item"><a href="#const-VERSION">VERSION</a></li>

</ul>
<ul>
  <li id="index-static-properties"><a href="#static-properties">Static properties</a></li>
  <li class="item"><a href="#property-HEADERS_TO_CHECK">HEADERS_TO_CHECK</a></li>

</ul>
<ul>
  <li id="index-methods"><a href="#methods">Methods</a></li>
  <li class="item"><a href="#method-__construct">__construct</a></li>
<li class="item"><a href="#method-getDataFileCopyright">getDataFileCopyright</a></li>
<li class="item"><a href="#method-getDataFileCreationDate">getDataFileCreationDate</a></li>
<li class="item"><a href="#method-getDataFileVersion">getDataFileVersion</a></li>
<li class="item"><a href="#method-getIp">getIp</a></li>
<li class="item"><a href="#method-getProperties">getProperties</a></li>
<li class="item"><a href="#method-getProperties ">getProperties </a></li>
<li class="item"><a href="#method-getProperty">getProperty</a></li>
<li class="item"><a href="#method-getProperty ">getProperty </a></li>
<li class="item"><a href="#method-getPropertyNames">getPropertyNames</a></li>
<li class="item"><a href="#method-isPublicIp">isPublicIp</a></li>
<li class="item"><a href="#method-loadDataFromFile">loadDataFromFile</a></li>

</ul>

</ul>


    <div id="goto-top"><a href="#">TOP</a></div>

    <div id="doc">
      <h1>Mobi_Mtld_DA_Carrier_CarrierApi</h1>

      <div id="class-specs">
        <div id="class-comment">The main class for the Carrier Identification API. Used to load the data file and
to perform lookups using IPv4 addresses. For usage in a Web App it is
recommended to use the CarrierApiWeb (CarrierApiWeb.php) class so you don't
have to pass the client's IP address manually.

Please note that it is advisable to load only a single instance of this class
to avoid multiple loadings of the data file.

Example usage:
<pre>
     $ip = '62.40.34.220';
     $carrierApi = new CarrierApi();
     $carrierApi->loadDataFromFile('/path/to/sample.dat');

     // get all properties
     $props = $carrierApi->getProperties($ip);
     // .... use the properties ....
     if ($props->containsKey('networkOperator')) {
         $property = $props->get('networkOperator');
         $operatorName = $property->asString();
         print('networkOperator: ' . $operatorName);
     }

     // get a single property
     $mccProp = $carrierApi->getProperty($ip, 'mcc');
     if ($mccProp !== null) {
         $mcc = $mccProp->asString();
         print('MCC: ' . $mcc);
     }
</pre>
Please see the code in the Examples directory for additional samples.</div>
        <div id="class-info">
          <dl><dt class="file">Source</dt>
<dd class="file">CarrierApi.php</dd>
<dt class="dependencies">Depends on</dt>
<dd class="dependencies">Exception<br/><a href="../../Mobi_Mtld_DA_Carrier/classes/Mobi_Mtld_DA_Carrier_CarrierData.html">Mobi_Mtld_DA_Carrier_CarrierData</a><br/><a href="../../Mobi_Mtld_DA/classes/Mobi_Mtld_DA_Properties.html">Mobi_Mtld_DA_Properties</a><br/><a href="../../Mobi_Mtld_DA/classes/Mobi_Mtld_DA_Property.html">Mobi_Mtld_DA_Property</a><br/><a href="../../Mobi_Mtld_DA_Exception/classes/Mobi_Mtld_DA_Exception_MissingDataException.html">Mobi_Mtld_DA_Exception_MissingDataException</a><br/><a href="../../Mobi_Mtld_DA_Exception/classes/Mobi_Mtld_DA_Exception_InvalidPropertyNameException.html">Mobi_Mtld_DA_Exception_InvalidPropertyNameException</a></dd>
</dl>
        </div>
        <div id="class-atts"><dl class="class-atts"><dt class="copyright">Copyright</dt>
<dd class="copyright">Copyright (c) 2008-2015 by Afilias Technologies Limited (dotMobi). All rights reserved.</dd>
<dt class="author">Author</dt>
<dd class="author">Afilias Technologies Ltd</dd>
</dl>
</div>
      </div>

      <h2 id="consts-title">Constants</h2>
<div id="consts"><div class="const odd first" id="const-MIN_PHP_VERSION">
  <h3>MIN_PHP_VERSION <span>= '5.2.3'</span></h3>
  <div class="const-specs">
    <p class="const-comment">Min PHP version required for this API to work</p>
    
  </div>
</div>
<div class="const even last" id="const-VERSION">
  <h3>VERSION <span>= 'API-VERSION'</span></h3>
  <div class="const-specs">
    <p class="const-comment">Carrier API version</p>
    
  </div>
</div>
</div>


      <h2 id="static-properties-title">Static Properties</h2>
<div id="static-properties"><div class="property public static odd first last" id="property-HEADERS_TO_CHECK">
  <h3>HEADERS_TO_CHECK<span> = array</span></h3>
  <div class="property-specs">

    <div><pre class="property-def expanded">HEADERS_TO_CHECK<span class="property-value"> = array(
        'x-forwarded-for',
        'client-ip', 
        'x-client-ip', 
        'rlnclientipaddr',    // from f5 load balancers
        'proxy-client-ip',
        'wl-proxy-client-ip', // weblogic load balancers
        'x-forwarded',
        'forwarded-for',
        'forwarded',
    )</span></pre></div>
    <p class="property-comment">A list of HTTP headers to choose the original client IP address from. In
addition to these the RemoteAddr (REMOTE_ADDR) is also used as a final
fallback.</p>
    

  </div>
</div>
</div>


      

      

      <h2 id="methods-title">Methods</h2>
<div id="methods"><div class="method public  odd first" id="method-__construct">
  <h3>__construct</h3>
  <div class="method-specs">

    <div><pre class="method-def compact"><span class="return-type">Mobi_Mtld_DA_Carrier_CarrierApi</span> $obj = new Mobi_Mtld_DA_Carrier_CarrierApi()</pre></div>

    <p class="method-comment">Construct a Carrier API object and load the data file (if path is provided).</p>

    
    
    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class="">void</dt>
<dd class=""></dd>
</dl>

</div>


    <h4>Throws</h4>
<div class="method-throws">
  <ul class="items-container">
<li>Exception If PHP version is less than required</li>

</ul>

</div>



  </div>
</div>
<div class="method public  even" id="method-getDataFileCopyright">
  <h3>getDataFileCopyright</h3>
  <div class="method-specs">

    <div><pre class="method-def compact"><span class="return-type">string </span>$obj->getDataFileCopyright()</pre></div>

    <p class="method-comment">Returns the data file copyright text.</p>

    
    
    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class="">string</dt>
<dd class=""> the copyright</dd>
</dl>

</div>


    

  </div>
</div>
<div class="method public  odd" id="method-getDataFileCreationDate">
  <h3>getDataFileCreationDate</h3>
  <div class="method-specs">

    <div><pre class="method-def compact"><span class="return-type">string </span>$obj->getDataFileCreationDate()</pre></div>

    <p class="method-comment">Returns the data file creation date in ISO8601 format.</p>

    
    
    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class="">string</dt>
<dd class=""> the creationDate</dd>
</dl>

</div>


    

  </div>
</div>
<div class="method public  even" id="method-getDataFileVersion">
  <h3>getDataFileVersion</h3>
  <div class="method-specs">

    <div><pre class="method-def compact"><span class="return-type">string </span>$obj->getDataFileVersion()</pre></div>

    <p class="method-comment">Returns the version of the data file.</p>

    
    
    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class="">string</dt>
<dd class=""> the version</dd>
</dl>

</div>


    

  </div>
</div>
<div class="method public  odd" id="method-getIp">
  <h3>getIp</h3>
  <div class="method-specs">

    <div><pre class="method-def compact"><span class="return-type">string </span>$obj->getIp(<span class="param-type">array</span> <span class="param-name">keyVals</span>)</pre></div>

    <p class="method-comment">Get the most suitable IP address from the given keyVals set of HTTP
headers. This function checks the headers defined in HEADERS_TO_CHECK.</p>

    
    <h4>Arguments</h4>
<div class="method-args">
  <ul class="items-container">
<div class="argument">
  <dl>
    <dt>
      keyVals
      <span>(array)</span>
    </dt>
    <dd>
       array of headers
    </dd>
  </dl>
</div>

</ul>

</div>


    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class="">string</dt>
<dd class=""> The most suitable IP or NULL if a suitable IP could not be found.</dd>
</dl>

</div>


    

  </div>
</div>
<div class="method public  even" id="method-getProperties">
  <h3>getProperties</h3>
  <div class="method-specs">

    <div><pre class="method-def compact"><span class="return-type">Mobi_Mtld_DA_Properties </span>$obj->getProperties(<span class="param-type">string | int</span> <span class="param-name">ipv4</span>)</pre></div>

    <p class="method-comment">Get the Carrier properties for a given IP address.</p>

    
    <h4>Arguments</h4>
<div class="method-args">
  <ul class="items-container">
<div class="argument">
  <dl>
    <dt>
      ipv4
      <span>(string | int)</span>
    </dt>
    <dd>
       The IP address to find carrier properties for.
    </dd>
  </dl>
</div>

</ul>

</div>


    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class=""><a href="../../Mobi_Mtld_DA/classes/Mobi_Mtld_DA_Properties.html">Mobi_Mtld_DA_Properties</a></dt>
<dd class=""> The found properties or null of no properties found.</dd>
</dl>

</div>


    

  </div>
</div>
<div class="method public  odd" id="method-getProperties ">
  <h3>getProperties </h3>
  <div class="method-specs">

    <div><pre class="method-def compact"><span class="return-type">Mobi_Mtld_DA_Properties </span>$obj->getProperties(<span class="param-type">array</span> <span class="param-name">ipv4</span>)</pre></div>

    <p class="method-comment">Get the Carrier properties for a given set of HTTP headers.</p>

    
    <h4>Arguments</h4>
<div class="method-args">
  <ul class="items-container">
<div class="argument">
  <dl>
    <dt>
      ipv4
      <span>(array)</span>
    </dt>
    <dd>
       An array of HTTP headers, the keys will be normalized.
    </dd>
  </dl>
</div>

</ul>

</div>


    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class=""><a href="../../Mobi_Mtld_DA/classes/Mobi_Mtld_DA_Properties.html">Mobi_Mtld_DA_Properties</a></dt>
<dd class=""> The found properties or null of no properties found.</dd>
</dl>

</div>


    

  </div>
</div>
<div class="method public  even" id="method-getProperty">
  <h3>getProperty</h3>
  <div class="method-specs">

    <div><pre class="method-def compact"><span class="return-type">Mobi_Mtld_DA_Property </span>$obj->getProperty(<span class="param-type">string | int</span> <span class="param-name">ipv4</span>, <span class="param-type">string</span> <span class="param-name">propertyName</span>)</pre></div>

    <p class="method-comment">Try and get a specific property for a given IP address.

Note: if multiple properties are needed for the same IP it is more efficient
to call getProperties() once than repeated calls to getProperty().</p>

    
    <h4>Arguments</h4>
<div class="method-args">
  <ul class="items-container">
<div class="argument">
  <dl>
    <dt>
      ipv4
      <span>(string | int)</span>
    </dt>
    <dd>
       The IP address to find carrier properties for.
    </dd>
  </dl>
</div>
<div class="argument">
  <dl>
    <dt>
      propertyName
      <span>(string)</span>
    </dt>
    <dd>
       The name of the property to return
    </dd>
  </dl>
</div>

</ul>

</div>


    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class=""><a href="../../Mobi_Mtld_DA/classes/Mobi_Mtld_DA_Property.html">Mobi_Mtld_DA_Property</a></dt>
<dd class=""> The Property or null if no property found.</dd>
</dl>

</div>


    <h4>Throws</h4>
<div class="method-throws">
  <ul class="items-container">
<li>Mobi_Mtld_DA_Exception_InvalidPropertyNameException
Thrown if the property name does not exist.</li>

</ul>

</div>



  </div>
</div>
<div class="method public  odd" id="method-getProperty ">
  <h3>getProperty </h3>
  <div class="method-specs">

    <div><pre class="method-def compact"><span class="return-type">Mobi_Mtld_DA_Property </span>$obj->getProperty(<span class="param-type">array</span> <span class="param-name">ipv4</span>, <span class="param-type">string</span> <span class="param-name">propertyName</span>)</pre></div>

    <p class="method-comment">Try and get a specific property for a given IP address.

Note: if multiple properties are needed for the same IP it is more efficient
to call getProperties() once than repeated calls to getProperty().</p>

    
    <h4>Arguments</h4>
<div class="method-args">
  <ul class="items-container">
<div class="argument">
  <dl>
    <dt>
      ipv4
      <span>(array)</span>
    </dt>
    <dd>
       An array of HTTP headers, the keys will be normalized.
    </dd>
  </dl>
</div>
<div class="argument">
  <dl>
    <dt>
      propertyName
      <span>(string)</span>
    </dt>
    <dd>
       The name of the property to return
    </dd>
  </dl>
</div>

</ul>

</div>


    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class=""><a href="../../Mobi_Mtld_DA/classes/Mobi_Mtld_DA_Property.html">Mobi_Mtld_DA_Property</a></dt>
<dd class=""> The Property or null if no property found.</dd>
</dl>

</div>


    <h4>Throws</h4>
<div class="method-throws">
  <ul class="items-container">
<li>Mobi_Mtld_DA_Exception_InvalidPropertyNameException
Thrown if the property name does not exist.</li>

</ul>

</div>



  </div>
</div>
<div class="method public  even" id="method-getPropertyNames">
  <h3>getPropertyNames</h3>
  <div class="method-specs">

    <div><pre class="method-def compact"><span class="return-type">array </span>$obj->getPropertyNames()</pre></div>

    <p class="method-comment">A set of all the possible property names. The Set contains PropertyName
objects that each have a name and an associated data type.</p>

    
    
    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class="">array</dt>
<dd class=""> array of possible property names.</dd>
</dl>

</div>


    

  </div>
</div>
<div class="method public  odd" id="method-isPublicIp">
  <h3>isPublicIp</h3>
  <div class="method-specs">

    <div><pre class="method-def compact"><span class="return-type">boolean </span>$obj->isPublicIp(<span class="param-type">string</span> <span class="param-name">ip</span>)</pre></div>

    <p class="method-comment">An IP address is considered public if it is not in any of the following
ranges:
<pre>
  1) any local address
     IP:  0

  2) a local loopback address
     range:  127/8

  3) a site local address i.e. IP is in any of the ranges:
     range:  10/8
     range:  172.16/12
     range:  192.168/16

  4) a link local address
     range:  169.254/16
</pre></p>

    
    <h4>Arguments</h4>
<div class="method-args">
  <ul class="items-container">
<div class="argument">
  <dl>
    <dt>
      ip
      <span>(string)</span>
    </dt>
    <dd>
       The IP address to check
    </dd>
  </dl>
</div>

</ul>

</div>


    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class="">boolean</dt>
<dd class=""> True if it is a public IP, false if the IP is invalid or is not public.</dd>
</dl>

</div>


    

  </div>
</div>
<div class="method public  even last" id="method-loadDataFromFile">
  <h3>loadDataFromFile</h3>
  <div class="method-specs">

    <div><pre class="method-def compact"><span class="return-type">void </span>$obj->loadDataFromFile(<span class="param-type">string</span> <span class="param-name">path</span>)</pre></div>

    <p class="method-comment">Load the data file from the provided path. The data file is reloaded
every time this method is called.</p>

    
    <h4>Arguments</h4>
<div class="method-args">
  <ul class="items-container">
<div class="argument">
  <dl>
    <dt>
      path
      <span>(string)</span>
    </dt>
    <dd>
       The path on disk to the carrier data file.
    </dd>
  </dl>
</div>

</ul>

</div>


    <h4>Returns</h4>
<div class="method-return">
  <dl class="method-return"><dt class="">void</dt>
<dd class=""></dd>
</dl>

</div>


    <h4>Throws</h4>
<div class="method-throws">
  <ul class="items-container">
<li>IOException Thrown when there is a problem loading the file.</li>
<li><a href="../../Mobi_Mtld_DA_Exception/classes/Mobi_Mtld_DA_Exception_DataFileException.html">Mobi_Mtld_DA_Exception_DataFileException</a> Thrown when there is a problem with the data file.</li>

</ul>

</div>



  </div>
</div>
</div>


    </div>
  </body>
</html>
