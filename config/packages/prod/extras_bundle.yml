framework:
  cache:
    app: app_redis_connection_adapter

doctrine:
  orm:
    metadata_cache_driver:
      type: service
      id: doctrine_redis_cache_service
    result_cache_driver:
      type: service
      id: doctrine_redis_cache_service
    query_cache_driver:
      type: service
      id: doctrine_redis_cache_service

services:
  doctrine_redis_cache_service:
    class: Doctrine\Common\Cache\RedisCache

    calls:
      - method: setNamespace
        arguments:
          - 'v%app_version_hash%'
      - method: setRedis
        arguments:
          - '@doctrine_redis_connection'

  doctrine_redis_connection:
    class: Redis
    public: false
    factory: ['@app.cache.redis_connection_provider', create]
    arguments: [1]

  app_redis_connection_adapter:
    class: Symfony\Component\Cache\Adapter\RedisAdapter
    public: false
    factory: ['@app.cache.redis_connection_provider', createWrapped]
    arguments: [1]

